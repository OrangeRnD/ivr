<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ibk.ivr.ca.data.tranalysis.dao.DataTrAnalysisDAO">
    <select id="selectList" parameterType="com.ibk.ivr.ca.common.vo.RequestVO" resultType="hashMap">
    	SELECT
			'' AS DT
			,0 AS CNT
			,SUM(CASE WHEN A.TM = '00' THEN A.CNT ELSE 0 END) AS CNT0
			,SUM(CASE WHEN A.TM = '01' THEN A.CNT ELSE 0 END) AS CNT1
			,SUM(CASE WHEN A.TM = '02' THEN A.CNT ELSE 0 END) AS CNT2
			,SUM(CASE WHEN A.TM = '03' THEN A.CNT ELSE 0 END) AS CNT3
			,SUM(CASE WHEN A.TM = '04' THEN A.CNT ELSE 0 END) AS CNT4
			,SUM(CASE WHEN A.TM = '05' THEN A.CNT ELSE 0 END) AS CNT5
			,SUM(CASE WHEN A.TM = '06' THEN A.CNT ELSE 0 END) AS CNT6
			,SUM(CASE WHEN A.TM = '07' THEN A.CNT ELSE 0 END) AS CNT7
			,SUM(CASE WHEN A.TM = '08' THEN A.CNT ELSE 0 END) AS CNT8
			,SUM(CASE WHEN A.TM = '09' THEN A.CNT ELSE 0 END) AS CNT9
			,SUM(CASE WHEN A.TM = '10' THEN A.CNT ELSE 0 END) AS CNT10
			,SUM(CASE WHEN A.TM = '11' THEN A.CNT ELSE 0 END) AS CNT11
			,SUM(CASE WHEN A.TM = '12' THEN A.CNT ELSE 0 END) AS CNT12
			,SUM(CASE WHEN A.TM = '13' THEN A.CNT ELSE 0 END) AS CNT13
			,SUM(CASE WHEN A.TM = '14' THEN A.CNT ELSE 0 END) AS CNT14
			,SUM(CASE WHEN A.TM = '15' THEN A.CNT ELSE 0 END) AS CNT15
			,SUM(CASE WHEN A.TM = '16' THEN A.CNT ELSE 0 END) AS CNT16
			,SUM(CASE WHEN A.TM = '17' THEN A.CNT ELSE 0 END) AS CNT17
			,SUM(CASE WHEN A.TM = '18' THEN A.CNT ELSE 0 END) AS CNT18
			,SUM(CASE WHEN A.TM = '19' THEN A.CNT ELSE 0 END) AS CNT19
			,SUM(CASE WHEN A.TM = '20' THEN A.CNT ELSE 0 END) AS CNT20
			,SUM(CASE WHEN A.TM = '21' THEN A.CNT ELSE 0 END) AS CNT21
			,SUM(CASE WHEN A.TM = '22' THEN A.CNT ELSE 0 END) AS CNT22
			,SUM(CASE WHEN A.TM = '23' THEN A.CNT ELSE 0 END) AS CNT23
		FROM (
			SELECT 
				T1.TM
				,AVG(T1.CNT) AS CNT
			FROM TBCA_HLY_TR_STAT T1
			INNER JOIN TBCA_CLDR T0
			ON T0.DT = T1.DT
	        <if test="param.RESTDE_ALTV != null and param.RESTDE_ALTV == 1">
	            AND NOT(T0.DT_SECD != '1' AND T0.DT_SECD != '7' AND T0.RESTDE_ALTV != #{param.RESTDE_ALTV})
	        </if>
	        <if test="param.RESTDE_ALTV != null and param.RESTDE_ALTV == 0">
	            AND T0.DT_SECD != '1' AND T0.DT_SECD != '7' AND T0.RESTDE_ALTV = #{param.RESTDE_ALTV}
	        </if>
			<![CDATA[
			WHERE T1.DT >= #{param.FROM_DT}
			AND T1.DT <= #{param.TO_DT}
			]]>
			GROUP BY T1.TM
		) A
		UNION ALL
		SELECT
			A.DT
			,COUNT(A.CNT) AS CNT
			,SUM(CASE WHEN A.TM = '00' THEN A.CNT ELSE 0 END) AS CNT0
			,SUM(CASE WHEN A.TM = '01' THEN A.CNT ELSE 0 END) AS CNT1
			,SUM(CASE WHEN A.TM = '02' THEN A.CNT ELSE 0 END) AS CNT2
			,SUM(CASE WHEN A.TM = '03' THEN A.CNT ELSE 0 END) AS CNT3
			,SUM(CASE WHEN A.TM = '04' THEN A.CNT ELSE 0 END) AS CNT4
			,SUM(CASE WHEN A.TM = '05' THEN A.CNT ELSE 0 END) AS CNT5
			,SUM(CASE WHEN A.TM = '06' THEN A.CNT ELSE 0 END) AS CNT6
			,SUM(CASE WHEN A.TM = '07' THEN A.CNT ELSE 0 END) AS CNT7
			,SUM(CASE WHEN A.TM = '08' THEN A.CNT ELSE 0 END) AS CNT8
			,SUM(CASE WHEN A.TM = '09' THEN A.CNT ELSE 0 END) AS CNT9
			,SUM(CASE WHEN A.TM = '10' THEN A.CNT ELSE 0 END) AS CNT10
			,SUM(CASE WHEN A.TM = '11' THEN A.CNT ELSE 0 END) AS CNT11
			,SUM(CASE WHEN A.TM = '12' THEN A.CNT ELSE 0 END) AS CNT12
			,SUM(CASE WHEN A.TM = '13' THEN A.CNT ELSE 0 END) AS CNT13
			,SUM(CASE WHEN A.TM = '14' THEN A.CNT ELSE 0 END) AS CNT14
			,SUM(CASE WHEN A.TM = '15' THEN A.CNT ELSE 0 END) AS CNT15
			,SUM(CASE WHEN A.TM = '16' THEN A.CNT ELSE 0 END) AS CNT16
			,SUM(CASE WHEN A.TM = '17' THEN A.CNT ELSE 0 END) AS CNT17
			,SUM(CASE WHEN A.TM = '18' THEN A.CNT ELSE 0 END) AS CNT18
			,SUM(CASE WHEN A.TM = '19' THEN A.CNT ELSE 0 END) AS CNT19
			,SUM(CASE WHEN A.TM = '20' THEN A.CNT ELSE 0 END) AS CNT20
			,SUM(CASE WHEN A.TM = '21' THEN A.CNT ELSE 0 END) AS CNT21
			,SUM(CASE WHEN A.TM = '22' THEN A.CNT ELSE 0 END) AS CNT22
			,SUM(CASE WHEN A.TM = '23' THEN A.CNT ELSE 0 END) AS CNT23
		FROM (
			SELECT 
				T1.DT
				,T1.TM
				,T1.CNT
			FROM TBCA_HLY_TR_STAT T1
			INNER JOIN TBCA_CLDR T0
			ON T0.DT = T1.DT
	        <if test="param.RESTDE_ALTV != null and param.RESTDE_ALTV == 1">
	            AND NOT(T0.DT_SECD != '1' AND T0.DT_SECD != '7' AND T0.RESTDE_ALTV != #{param.RESTDE_ALTV})
	        </if>
	        <if test="param.RESTDE_ALTV != null and param.RESTDE_ALTV == 0">
	            AND T0.DT_SECD != '1' AND T0.DT_SECD != '7' AND T0.RESTDE_ALTV = #{param.RESTDE_ALTV}
	        </if>
			<![CDATA[
			WHERE T1.DT >= #{param.FROM_DT}
			AND T1.DT <= #{param.TO_DT}
			]]>
		) A
		GROUP BY A.DT
    </select>
</mapper>